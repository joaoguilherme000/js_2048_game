class t{static Status={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=e,this.state=this.initialState.map(t=>[...t]),this.status=t.Status.idle,this.score=0}moveLeft(){if(this.getStatus()!==t.Status.playing)return;let e=this.state.map(t=>this.move(t));JSON.stringify(this.getState())!==JSON.stringify(e)&&(this.updateGameState(e),this.insertTiles())}moveRight(){if(this.getStatus()!==t.Status.playing)return;let e=this.state.map(t=>[...t].reverse()).map(t=>this.move(t).reverse());JSON.stringify(this.getState())!==JSON.stringify(e)&&(this.updateGameState(e),this.insertTiles())}moveUp(){if(this.getStatus()!==t.Status.playing)return;let e=this.rotateLeft(this.getState()).map(t=>this.move(t)),s=this.rotateRight(e);JSON.stringify(this.getState())!==JSON.stringify(s)&&(this.updateGameState(s),this.insertTiles())}moveDown(){if(this.getStatus()!==t.Status.playing)return;let e=this.rotateRight(this.getState()).map(t=>this.move(t)),s=this.rotateLeft(e);JSON.stringify(this.getState())!==JSON.stringify(s)&&(this.updateGameState(s),this.insertTiles())}move(t){let e=[],s=0;for(;s<t.length;){let i=t[s];if(i){let a=!1;for(let r=s+1;r<t.length;r++){let l=t[r];if(l===i){e.push(2*i),this.updateGameScore(2*i),a=!0,s=r+1;break}if(l){e.push(i),a=!0,s=r;break}}!a&&(e.push(i),s++)}else s++}return[...e,...Array(t.length-e.length).fill(0)]}rotateRight(t){let e=t.length,s=[];for(let i=0;i<e;i++){s.push([]);for(let a=0;a<e;a++)s[i].unshift(t[a][i])}return s}rotateLeft(t){let e=t.length,s=[];for(let i=0;i<e;i++){s.unshift([]);for(let a=0;a<e;a++)s[0].push(t[a][i])}return s}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=t.Status.playing,this.insertTiles(2)}restart(){this.status=t.Status.idle,this.resetState()}findEmptyCells(){return this.state.reduce((t,e,s)=>(e.forEach((e,i)=>{0===e&&t.push([s,i])}),t),[])}generateTiles(){let t=this.findEmptyCells();if(!t.length)return;let[e,s]=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}insertTiles(t=1){for(let e=0;e<t;e++)this.generateTiles();this.updateGameStatus()}updateGameStatus(){let e=this.getState();this.isVictory(e)?this.status=t.Status.win:this.isStateValid(e)||(this.status=t.Status.lose)}resetState(){this.state=this.initialState.map(t=>[...t]),this.score=0}isStateValid(e){if(this.status!==t.Status.playing)return!1;for(let t=0;t<e.length;t++)for(let s=0;s<e[t].length;s++)if(s<e[t].length-1&&e[t][s]===e[t][s+1]||t<e.length-1&&e[t][s]===e[t+1][s]||!e[t][s])return!0;return!1}updateGameState(t){this.state=t}updateGameScore(t){this.score+=t}isVictory(t){return t.flat().some(t=>2048===t)}}const e=new t,s=document.querySelector(".container"),i=document.querySelector(".game-field"),a=s.querySelector(".button"),r=s.querySelector(".game-score"),l=[...i.querySelectorAll(".field-row")].map(t=>[...t.children]),n={idle:s.querySelector(".message-start"),lose:s.querySelector(".message-lose"),win:s.querySelector(".message-win")};function h(t){t.forEach((t,e)=>{t.forEach((t,s)=>{let i=l[e][s];i.className=t?`field-cell field-cell--${t}`:"field-cell",i.textContent=t||""})})}function o(){let t=e.getStatus();Object.keys(n).forEach(e=>{let s=n[e];s&&s.classList.toggle("hidden",e!==t)})}function u(t){r.textContent=t}a.addEventListener("click",function(){"Start"===a.textContent?(e.start(),a.textContent="Restart",a.classList.replace("start","restart")):(e.restart(),u(0),a.textContent="Start",a.classList.replace("restart","start")),h(e.getState()),o()}),document.addEventListener("keydown",t=>{if(t.preventDefault(),"playing"!==e.getStatus())return;let s={ArrowUp:e.moveUp,ArrowDown:e.moveDown,ArrowLeft:e.moveLeft,ArrowRight:e.moveRight}[t.key];s&&(s.call(e),h(e.getState()),u(e.getScore()),o())});
//# sourceMappingURL=index.4bc47fd0.js.map
